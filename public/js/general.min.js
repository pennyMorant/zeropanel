function countdown(e,o){let t=null;function r(){let r=new Date(e),a=new Date().getTime(),n=r.getTime()-a;if(n<=0)clearInterval(t);else{let s=`${Math.floor(n/864e5)}${i18next.t("day")} ${Math.floor(n%864e5/36e5)}:${Math.floor(n%36e5/6e4)}:${Math.floor(n%6e4/1e3)}`;document.getElementById(o).innerHTML=s}}r(),t=setInterval(r,1e3)}function getCookie(e){for(var o=e+"=",t=document.cookie.split(";"),r=0;r<t.length;r++){var a=t[r].trim();if(0==a.indexOf(o))return a.substring(o.length,a.length)}return""}var clipboard=new ClipboardJS(".copy-text");function getResult(e,o,t){Swal.fire({title:e,text:o,icon:t,buttonsStyling:!1,confirmButtonText:"OK",customClass:{confirmButton:"btn btn-primary"}})}function getLoad(){Swal.fire({title:"",text:"",timer:5e4,confirmButtonText:"",didOpen:function(){Swal.showLoading()}}).then(function(e){"timer"==e.dismiss&&console.log("I was closed by the timer")})}function kTUserConfigureProductModal(e){let o=document.querySelector(`[data-kt-users-action="check-out-${e}"]`);o.setAttribute("data-kt-indicator","on"),o.disabled=!0,setTimeout(function(){new Promise(function(o,t){$.ajax({type:"POST",url:"/user/product/getinfo",dataType:"json",data:{id:e},success:function(e){o(e)}})}).then(function(t){let r=t,a=$("#zero_product_"+e).html(),n=r.name,s=r.month_price,i=r.quarter_price,d=r.half_year_price,l=r.year_price,c=r.two_year_price,u=r.onetime_price;var m=$("#zero_modal_configure_product_inner_html"),f=$("#zero_modal_configure_product_name"),p=$("#zero_modal_configure_product_price"),h=$("#zero_modal_configure_product_total"),y=$("#zero_modal_configure_coupon"),b=$("#zero_modal_configure_coupon_html");let v=document.querySelector('[data-kt-users-action="submit"]');if(1==r.type){let g={month_price:{label:i18next.t("monthly fee"),value:parseFloat(s)},quarter_price:{label:i18next.t("quarterly fee"),value:parseFloat(i)},half_year_price:{label:i18next.t("semi annua fee"),value:parseFloat(d)},year_price:{label:i18next.t("annual fee"),value:parseFloat(l)},two_year_price:{label:i18next.t("biennial fee"),value:parseFloat(c)},onetime_price:{label:i18next.t("onetime fee"),value:parseFloat(u)}};console.log(g);let z=[g.month_price,g.quarter_price,g.half_year_price,g.year_price,g.two_year_price,g.onetime_price].filter(e=>null!==e.value&&void 0!==e.value&&!isNaN(e.value));minPrice=z.length>0?z.reduce((e,o)=>o.value<e.value?o:e,z[0]):null,console.log(minPrice),Object.entries(g).forEach(([o,{label:t,value:r}])=>{r&&($("#zero_modal_configure_product_"+o).html(`<a class="btn btn-outline btn-active-light-primary" data-bs-toggle="pill">${t}</a>`),$("#zero_modal_configure_product_"+o).attr("onclick",`KTUsersChangePlan("${r.toFixed(2)}", ${e}, "${o}")`),r==minPrice.value&&$(`#zero_modal_configure_product_${o} a`).addClass("active"))}),y.attr("onclick",`KTUserVerifyCoupon(${minPrice.value.toFixed(2)}, ${e})`)}m.html(a),3==r.type&&b.hide();let k=1==r.type?minPrice.value.toFixed(2):u;f.html(1==r.type?n+"&nbsp;X&nbsp;"+minPrice.label:n),p.html(`${k}&nbsp;${currency_unit}`),h.html(`${k}&nbsp;${currency_unit}`),v.setAttribute("onclick",`KTUsersCreateOrder(1, "${k}", ${e})`),$("#zero_modal_configure_product").modal("show"),o.removeAttribute("data-kt-indicator"),o.disabled=!1})},2e3)}function KTUsersChangePlan(e,o,t){let r={month_price:i18next.t("monthly fee"),quarter_price:i18next.t("quarterly fee"),half_year_price:i18next.t("semi annua fee"),year_price:i18next.t("annual fee"),two_year_price:i18next.t("biennial fee")},a=$("#zero_product_name_"+o).html(),n=document.querySelector('[data-kt-users-action="submit"]'),s=$("#zero_modal_configure_coupon");s.attr("onclick",`KTUserVerifyCoupon("${e}", ${o})`),$("#zero_modal_configure_product_name").html(`${a} X ${r[t]}`),$("#zero_modal_configure_product_price").html(`${e}&nbsp;${currency_unit}`),$("#zero_modal_configure_product_total").html(`${e}&nbsp;${currency_unit}`),n.setAttribute("onclick",`KTUsersCreateOrder(1, "${e}", ${o})`)}function KTUserVerifyCoupon(e,o){let t=document.querySelector('[data-kt-users-action="verify-coupon"]');t.setAttribute("data-kt-indicator","on"),t.disabled=!0,setTimeout(function(){$.ajax({type:"POST",url:"/user/verify_coupon",dataType:"json",data:{coupon_code:$("#zero_coupon_code").val(),product_price:e,product_id:o},success:function(e){1==e.ret?$("#zero_modal_configure_product_total").html(`${e.total}&nbsp;${currency_unit}`):getResult(e.msg,"","error"),t.removeAttribute("data-kt-indicator"),t.disabled=!1}})},2e3)}function KTUsersCreateOrder(e,o,t){let r=document.querySelector('[data-kt-users-action="submit"]');switch(r.setAttribute("data-kt-indicator","on"),r.disabled=!0,e){case 1:setTimeout(function(){$.ajax({type:"POST",url:`/user/order/create_order/${e}`,dataType:"json",data:{product_id:t,product_price:o,coupon_code:$("#zero_coupon_code").val()},success:function(e){1==e.ret?$(location).attr("href",`/user/order/${e.order_no}`):(getResult(e.msg,"","error"),r.removeAttribute("data-kt-indicator"),r.disabled=!1)}})},2e3);break;case 2:setTimeout(function(){$.ajax({type:"POST",url:"/user/order/create_order/"+e,dataType:"json",data:{add_credit_amount:$("#add_credit_amount").val()},success:function(e){1==e.ret?$(location).attr("href",`/user/order/${e.order_no}`):(getResult(e.msg,"","error"),r.removeAttribute("data-kt-indicator"),r.disabled=!1)}})},2e3);break;case 3:$.ajax({type:"POST",url:"/user/order/create_order/"+e,dataType:"json",data:{},success:function(e){1==e.ret?$(location).attr("href",`/user/order/${e.order_no}`):getResult(e.msg,"","error")}});break;default:getResult("请求错误","","error")}}function KTUsersPayOrder(e){let o=document.querySelector('[data-kt-users-action="submit"]');o.setAttribute("data-kt-indicator","on"),o.disabled=!0;let t=$("#payment_method a.active").attr("data-payment-id"),r=e;setTimeout(()=>{$.ajax({type:"POST",url:"/user/order/pay_order",dataType:"json",data:{payment_id:t,order_no:r},success:function(e){1==e.ret?$(location).attr("href",e.url):2==e.ret?(Swal.fire({text:e.msg,icon:"success",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}}).then(function(e){e.isConfirmed&&location.reload()}),o.removeAttribute("data-kt-indicator"),o.disabled=!1):(getResult(e.msg,"","error"),o.removeAttribute("data-kt-indicator"),o.disabled=!1)}})},2e3)}function KTUsersTicket(e,o,t){let r=document.querySelector('[data-kt-users-action="submit"]');r.setAttribute("data-kt-indicator","on"),r.disabled=!0;var a=editors.getData();switch(e){case"create_ticket":setTimeout(function(){$.ajax({type:"POST",url:"/user/ticket/create",dataType:"json",data:{title:$("#zero_create_ticket_title").val(),comment:a,type:$("#zero_create_ticket_type").val()},success:function(e){1==e.ret?$(location).attr("href",`/user/ticket/view/${e.id}`):(getResult(e.msg,"","error"),r.removeAttribute("data-kt-indicator"),r.disabled=!1)}})},2e3);break;case"reply_ticket":setTimeout(function(){$.ajax({type:"PUT",url:"/user/ticket/update",dataType:"json",data:{id:o,status:t,comment:a},success:function(e){1==e.ret?location.reload():(getResult(e.msg,"","error"),r.removeAttribute("data-kt-indicator"),r.disabled=!1)}})},2e3)}}function KTUsersShowNodeInfo(e,o,t){nodeid=e,(usersclass=o)>=(nodesclass=t)?(getLoad(),$.ajax({type:"GET",url:"/user/nodeinfo/"+nodeid,dataType:"json",data:{},success:function(e){if(1==e.ret){let o=e.info,t=`<div class="pb-3" align="center" id="qrcode_${nodeid}"></div>`;var r=e.url;switch(e.type){case 2:let a={"#zero_modal_vmess_node_info_remark":"remark","#zero_modal_vmess_node_info_address":"address","#zero_modal_vmess_node_info_port":"port","#zero_modal_vmess_node_info_aid":"aid","#zero_modal_vmess_node_info_uuid":"uuid","#zero_modal_vmess_node_info_net":"net","#zero_modal_vmess_node_info_path":"path","#zero_modal_vmess_node_info_host":"host","#zero_modal_vmess_node_info_servicename":"servicename","#zero_modal_vmess_node_info_type":"type","#zero_modal_vmess_node_info_security":"security"};for(let n in a)$(n).html(o[a[n]]);$("#zero_modal_vmess_node_info_qrcode").html(t),$("#zero_modal_vmess_node_info").modal("show");break;case 4:let s={"#zero_modal_trojan_node_info_remark":"remark","#zero_modal_trojan_node_info_address":"address","#zero_modal_trojan_node_info_port":"port","#zero_modal_trojan_node_info_uuid":"uuid","#zero_modal_trojan_node_info_sni":"sni","#zero_modal_trojan_node_info_security":"security","#zero_modal_trojan_node_info_flow":"flow"};for(let i in s)$(i).html(o[s[i]]);$("#zero_modal_trojan_node_info_qrcode").html(t),$("#zero_modal_trojan_node_info").modal("show");break;case 3:let d={"#zero_modal_vless_node_info_remark":"remark","#zero_modal_vless_node_info_address":"address","#zero_modal_vless_node_info_port":"port","#zero_modal_vless_node_info_uuid":"uuid","#zero_modal_vless_node_info_net":"net","#zero_modal_vless_node_info_path":"path","#zero_modal_vless_node_info_host":"host","#zero_modal_vless_node_info_servicename":"servicename","#zero_modal_vless_node_info_type":"type","#zero_modal_vless_node_info_security":"security","#zero_modal_vless_node_info_flow":"flow","#zero_modal_vless_node_info_sni":"sni"};for(let l in d)$(l).html(o[d[l]]);$("#zero_modal_vless_node_info_qrcode").html(t),$("#zero_modal_vless_node_info").modal("show");break;case 1:let c={"#zero_modal_shadowsocks_node_info_remark":"remark","#zero_modal_shadowsocks_node_info_address":"address","#zero_modal_shadowsocks_node_info_port":"port","#zero_modal_shadowsocks_node_info_method":"method","#zero_modal_shadowsocks_node_info_passwd":"passwd"};for(let u in c)$(u).html(o[c[u]]);$("#zero_modal_shadowsocks_node_info_qrcode").html(t),$("#zero_modal_shadowsocks_node_info").modal("show");break;case 5:let m={"#zero_modal_hysteria_node_info_remark":"remark","#zero_modal_hysteria_node_info_address":"address","#zero_modal_hysteria_node_info_port":"port","#zero_modal_hysteria_node_info_obfsParam":"obfsParam","#zero_modal_hysteria_node_info_protocol":"protocol","#zero_modal_hysteria_node_info_obfs":"obfs","#zero_modal_hysteria_node_info_alpn":"alpn","#zero_modal_hysteria_node_info_upspeed":"upmbps","#zero_modal_hysteria_node_info_downspeed":"downmbps","#zero_modal_hysteria_node_info_peer":"peer"};for(let f in m)$(f).html(o[m[f]]);$("#zero_modal_hysteria_node_info_qrcode").html(t),$("#zero_modal_hysteria_node_info").modal("show")}$("#qrcode_"+nodeid).qrcode({width:200,height:200,render:"canvas",text:r}),Swal.close()}else getResult(e.msg,"","error")}})):getResult("权限不足","","error")}function KTUsersWithdrawCommission(e){switch(e){case 1:$.post("/user/withdraw_commission",{commission:$("#withdraw_commission_amount").val(),type:$("#withdraw_type a.active").attr("data-type")},function(e){getResult(e.msg,"",1==e.ret?"success":"error")},"json");break;case 2:$.post("/user/withdraw_account_setting",{acc:$("#withdraw_account_value").val(),method:$("#withdraw_method").val()},function(e){getResult(e.msg,"",1==e.ret?"success":"error")},"json")}}function oneclickImport(e,o){quanx_config={server_remote:[`${o}, tag=${webName}`]};var t={surfboard:`surfboard:///install-config?url=${encodeURIComponent(o)}`,quantumult:`quantumult://configuration?server=${btoa(o).replace(/=/g,"")}&filter=YUhSMGNITTZMeTl0ZVM1dmMyOWxZMjh1ZUhsNkwzSjFiR1Z6TDNGMVlXNTBkVzExYkhRdVkyOXVaZw`,shadowrocket:`shadowrocket://add/sub://${btoa(o)}`,surge4:`surge4:///install-config?url=${encodeURIComponent(o)}`,clash:`clash://install-config?url=${encodeURIComponent(o)}`,sagernet:`sn://subscription?url=${encodeURIComponent(o)}`,quantumultx:`quantumult-x:///add-resource?remote-resource=${encodeURIComponent(JSON.stringify(quanx_config))}`};Swal.fire({title:i18next.t("confirm importing subscription link"),icon:"warning",showCancelButton:!0,confirmButtonText:"Submit",cancelButtonText:"Discard",focusClose:!1,focusConfirm:!1}).then(o=>{o.value&&(window.location.href=t[e])})}clipboard.on("success",function(e){getResult(i18next.t("copy success"),"","success")}),$(document).ready(function(){var e,o=window.location.pathname.split("/");$(`a.menu-link[href='/${o[1]}/${o[2]}']`).addClass("active")});